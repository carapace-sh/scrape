# yaml-language-server: $schema=https://carapace.sh/schemas/command.json
name: but
description: A GitButler CLI tool
flags:
  -C, --current-dir=: Run as if gitbutler-cli was started in PATH instead of the current working directory
  -f, --format=: Explicitly control how output should be formatted
  -h, --help: Print help (see more with '--help')
  -V, --version: Print version
persistentflags:
  -j, --json: Whether to use JSON output format
documentation:
  flag:
    format: |-
      Explicitly control how output should be formatted.

      If unset and from a terminal, it defaults to human output, when redirected it's for shells.
    help: Print help (see a summary with '-h')
completion:
  flag:
    current-dir:
    - $files
    format:
    - "human\tThe output to write is supposed to be for human consumption, and can be more verbose"
    - "shell\tThe output should be suitable for shells, and assigning the major result to variables so that it can be reused in subsequent CLI invocations"
    - "json\tOutput detailed information as JSON for tool consumption"
    - "none\tDo not output anything, like redirecting to /dev/null"
  positional:
  - []
  - []
commands:
- name: status
  aliases:
  - st
  description: Overview of the project workspace state
  flags:
    -f: Determines whether the committed files should be shown as well
    --files&: Determines whether the committed files should be shown as well
    -h, --help: Print help (see more with '--help')
    -r, --review: Show the forge review information
    -v, --verbose: Show verbose output with commit author and timestamp
  documentation:
    command: |
      Overview of the project workspace state.

      This shows unassigned files, files assigned to stacks, all applied branches (stacked or parallel), commits on each of those branches, upstream commits that are unintegrated, commit status (pushed or local), and base branch information.

      Examples

      Normal usage:

        but status

      Shorthand with listing files modified

        but status -f
    flag:
      help: Print help (see a summary with '-h')
- name: rub
  description: Combines two entities together to perform an operation like amend, squash, assign, or move
  flags:
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |
      Combines two entities together to perform an operation like amend, squash, assign, or move.

      The rub command is a simple verb that helps you do a number of editing operations by doing combinations of two things.

      For example, you can "rub" a file onto a branch to assign that file to the branch. You can also "rub" a commit onto another commit to squash them together. You can rub a commit onto a branch to move that commit. You can rub a file from one commit to another.

      Non-exhaustive list of operations:

              │Source     │Target
        ──────┼───────────┼──────
        Amend │File,Branch│Commit
        Squash│Commit     │Commit
        Assign│File,Branch│Branch
        Move  │Commit     │Branch

      Examples

      Squashing two commits into one (combining the commit messages):

        but rub 3868155 abe3f53f

      Amending a commit with the contents of a modified file:

        but rub README.md abe3f53f

      Moving a commit from one branch to another:

        but rub 3868155 feature-branch
    flag:
      help: Print help (see a summary with '-h')
- name: init
  description: Initializes a GitButler project from a git repository in the current directory
  flags:
    -h, --help: Print help (see more with '--help')
    -r, --repo: Also initializes a git repository in the current directory if one does not exist
  documentation:
    command: |-
      Initializes a GitButler project from a git repository in the current directory.

      If you have an existing Git repository and want to start using GitButler with it, you can run this command to set up the necessary configuration and data structures.

      This is automatically run when you run any other but command in a git repository that is not yet initialized with GitButler.

      Note: Currently, if there is no Git repository already, you will need to initialize it with git init and add a remote first, as GitButler needs a remote to base the branches on.

      We are working on removing this limitation, but for now this is something to be aware of.
    flag:
      help: Print help (see a summary with '-h')
- name: base
  description: Commands for managing the base target branch
  flags:
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Commands for managing the base target branch.

      Every branch managed by GitButler is based off a common base branch on your remote repository (usually origin/main or origin/master). This is the target branch that all changes will eventually be integrated into.

      The base subcommand allows you to manage and update this base branch.

      When you run but base update, GitButler will fetch the latest changes from the remote and rebase all your applied branches on top of the updated base branch. You will want to do this regularly to keep your branches up to date with the latest changes from the main development line.

      You can also use but base check to verify that your branches can be cleanly merged into the base branch without conflicts and see what work is upstream an not yet integrated into your branches.
    flag:
      help: Print help (see a summary with '-h')
  commands:
  - name: check
    description: Fetches from the remote and checks the mergeability of the branches in the workspace
    flags:
      -h, --help: Print help (see more with '--help')
    documentation:
      command: |-
        Fetches from the remote and checks the mergeability of the branches in the workspace.

        This will see if the target branch has had new work merged into it, and if so, it will check if each branch in the workspace can be cleanly merged into the updated target branch.

        It will also show what work is upstream that has not yet been integrated into the branches.
      flag:
        help: Print help (see a summary with '-h')
  - name: update
    description: Updates all applied branches to be up to date with the target branch
    flags:
      -h, --help: Print help (see more with '--help')
    documentation:
      command: |-
        Updates all applied branches to be up to date with the target branch

        This fetches the latest changes from the remote and rebases all applied branches on top of the updated target branch.

        You should run this regularly to keep your branches up to date with the latest changes from the main development line.

        You can run but base check first to see if your branches can be cleanly merged into the target branch before running the update.
      flag:
        help: Print help (see a summary with '-h')
  - name: help
    description: Print this message or the help of the given subcommand(s)
    commands:
    - name: check
      description: Fetches from the remote and checks the mergeability of the branches in the workspace
    - name: update
      description: Updates all applied branches to be up to date with the target branch
    - name: help
      description: Print this message or the help of the given subcommand(s)
- name: branch
  description: Commands for managing branches
  flags:
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Commands for managing branches.

      This includes creating, deleting, listing, showing details about, and applying and unapplying branches.

      By default without a subcommand, it will list the branches.
    flag:
      help: Print help (see a summary with '-h')
  commands:
  - name: new
    description: Creates a new branch in the workspace
    flags:
      -a, --anchor=: Anchor point - either a commit ID or branch name to create the new branch from
      -h, --help: Print help (see more with '--help')
    documentation:
      command: |-
        Creates a new branch in the workspace

        If no branch name is provided, a new parallel branch with a generated name will be created.

        You can also specify an anchor point using the --anchor option, which can be either a commit ID or an existing branch name to create the new branch from. This allows you to create stacked branches.
      flag:
        help: Print help (see a summary with '-h')
  - name: delete
    description: Deletes a branch from the workspace
    flags:
      -f, --force: Force deletion without confirmation
      -h, --help: Print help (see more with '--help')
    documentation:
      command: |-
        Deletes a branch from the workspace

        This will remove the branch and all its commits from the workspace. If the branch has unpushed commits, you will be prompted for confirmation unless the --force flag is used.
      flag:
        help: Print help (see a summary with '-h')
  - name: list
    description: List the branches in the repository
    flags:
      -a, --all: Show all branches (not just active + 20 most recent)
      -h, --help: Print help (see more with '--help')
      -l, --local: Show only local branches
      --no-ahead: Don't calculate and show number of commits ahead of base (faster)
      --no-check: Don't check if each branch merges cleanly into upstream
      -r, --remote: Show only remote branches
      --review: Fetch and display review information (PRs, MRs, etc.)
    documentation:
      command: |-
        List the branches in the repository

        By default, shows the active branch and the 20 most recently updated branches.

        You can use the --all flag to show all branches, --local to show only local branches, or --remote to show only remote branches.

        You can also filter branch names by specifying a substring, such as but branch list feature to show only branches with "feature" in the name.

        If you want to check for review status, you can add --review to fetch and display pull request or merge request information for each branch. This will make the command slower as it needs to query the forge.

        By default, the command checks if each branch merges cleanly into the upstream base target branch (not your workspace). You can disable this check with --no-check to make the command faster.

        By default it also calculates the number of commits each branch is ahead of the base branch. You can disable this with --no-ahead to make the command faster.
      flag:
        help: Print help (see a summary with '-h')
  - name: show
    description: Show commits ahead of base for a specific branch
    flags:
      --ai: Generate AI summary of the branch changes
      --check: Check if the branch merges cleanly into upstream and identify conflicting commits
      -f, --files: Show files modified in each commit with line counts
      -h, --help: Print help (see more with '--help')
      -r, --review: Fetch and display review information
    documentation:
      command: |-
        Show commits ahead of base for a specific branch

        This shows the list of commits that are on the specified branch but not yet integrated into the base target branch.

        You can also choose to fetch and display review information, show files modified in each commit with line counts, generate an AI summary of the branch changes, and check if the branch merges cleanly into upstream.
      flag:
        help: Print help (see a summary with '-h')
  - name: apply
    description: Apply a branch to the workspace
    flags:
      -h, --help: Print help (see more with '--help')
    documentation:
      command: |-
        Apply a branch to the workspace

        If you want to apply an unapplied branch to your workspace so you can work on it, you can run but branch apply <branch-name>.`

        This will apply the changes in that branch into your working directory as a parallel applied branch.
      flag:
        help: Print help (see a summary with '-h')
  - name: unapply
    description: Unapply a branch from the workspace
    flags:
      -f, --force: Force unapply without confirmation
      -h, --help: Print help (see more with '--help')
    documentation:
      command: |-
        Unapply a branch from the workspace

        If you want to unapply an applied branch from your workspace (effectively stashing it) so you can work on other branches, you can run but branch unapply <branch-name>.

        This will remove the changes in that branch from your working directory and you can re-apply it later when needed. You will then see the branch as unapplied in but branch list.
      flag:
        help: Print help (see a summary with '-h')
  - name: help
    description: Print this message or the help of the given subcommand(s)
    commands:
    - name: new
      description: Creates a new branch in the workspace
    - name: delete
      description: Deletes a branch from the workspace
    - name: list
      description: List the branches in the repository
    - name: show
      description: Show commits ahead of base for a specific branch
    - name: apply
      description: Apply a branch to the workspace
    - name: unapply
      description: Unapply a branch from the workspace
    - name: help
      description: Print this message or the help of the given subcommand(s)
- name: mark
  description: Mark a commit or branch for auto-assign or auto-commit
  flags:
    -d, --delete: Deletes a mark
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Mark a commit or branch for auto-assign or auto-commit.

      Creates or removes a rule for auto-assigning or auto-committing changes to the specified target entity.

      If you mark a branch, new unassigned changes that GitButler sees when you run any command will be automatically assigned to that branch.

      If you mark a commit, new uncommitted changes will automatically be amended into the marked commit.
    flag:
      help: Print help (see a summary with '-h')
- name: unmark
  description: Removes any marks from the workspace
  flags:
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Removes any marks from the workspace

      This will unmark anything that has been marked by the but mark command.
    flag:
      help: Print help (see a summary with '-h')
- name: gui
  aliases:
  - .
  description: Open the GitButler GUI for the current project
  flags:
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Open the GitButler GUI for the current project.

      Running but gui will launch the GitButler graphical user interface in the current directory's GitButler project.

      This provides a visual way to manage branches, commits, and uncommitted changes, complementing the command-line interface.

      You can also just run but . as a shorthand to open the GUI.
    flag:
      help: Print help (see a summary with '-h')
- name: commit
  description: Commit changes to a stack
  flags:
    -c, --create: Whether to create a new branch for this commit. If the branch name given matches an existing branch, that branch will be used instead. If no branch name is given, a new branch with a generated name will be created
    -h, --help: Print help (see more with '--help')
    -m, --message=: Commit message
    -o, --only: Only commit assigned files, not unassigned files
  documentation:
    command: |-
      Commit changes to a stack.

      The but commit command allows you to create a new commit on a specified branch (stack) with the current uncommitted changes.

      If there is only one branch applied, it will commit to that branch by default.

      If there are multiple branches applied, you must specify which branch to commit to, or if in interactive mode, you will be prompted to select one.

      By default, all uncommitted changes and all changes already assigned to that branch will be included in the commit. If you only want to commit the changes that are already assigned to that branch, you can use the --only flag.

      It will not commit changes assigned to other branches.
    flag:
      help: Print help (see a summary with '-h')
- name: push
  description: Push changes in a branch to remote
  flags:
    -h, --help: Print help (see more with '--help')
    -r, --run-hooks: Run pre-push hooks
    -s, --skip-force-push-protection: Skip force push protection checks
    -f, --with-force: Force push even if it's not fast-forward
  documentation:
    command: |-
      Push changes in a branch to remote.

      but push will update the remote with the latest commits from the specified branch.

      Whatever the upstream remote is configured for the base branch, that will be used as the remote to push to.

      If you have another remote you want to push to that is different from the target remote (for example, a fork of an open source project), you can set it in the GitButler project settings. (Currently only via the GUI.)
    flag:
      help: Print help (see a summary with '-h')
- name: new
  description: Insert a blank commit before the specified commit, or at the top of a stack
  flags:
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Insert a blank commit before the specified commit, or at the top of a stack.

      This is useful for creating a placeholder commit that you can then amend changes into later using but mark, but rub or but absorb.

      You can modify the empty commit message at any time using but describe.

      This allows for a more Jujutsu style workflow where you create commits first and then fill them in as you work. Create an empty commit, mark it for auto-commit, and then just work on your changes. Write the commit message whenever you prefer.
    flag:
      help: Print help (see a summary with '-h')
- name: describe
  aliases:
  - desc
  description: Edit the commit message of the specified commit
  flags:
    -h, --help: Print help (see more with '--help')
    -m, --message=: The new commit message or branch name. If not provided, opens an editor
  documentation:
    command: |-
      Edit the commit message of the specified commit.

      You can easily change the commit message of any of your commits by running but describe <commit-id> and providing a new message in the editor.

      This will rewrite the commit with the new message and then rebase any dependent commits on top of it.

      You can also use but describe <branch-id> to rename the branch.
    flag:
      help: Print help (see a summary with '-h')
- name: oplog
  description: Show operation history
  flags:
    -h, --help: Print help (see more with '--help')
    --since=: Start from this oplog SHA instead of the head
  documentation:
    command: |-
      Show operation history.

      Displays a list of past operations performed in the repository, including their timestamps and descriptions.

      This allows you to restore to any previous point in the history of the project. All state is preserved in operations, including uncommitted changes.

      You can use but restore <oplog-sha> to restore to a specific state.
    flag:
      help: Print help (see a summary with '-h')
- name: restore
  description: Restore to a specific oplog snapshot
  flags:
    -f, --force: Skip confirmation prompt
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Restore to a specific oplog snapshot.

      This command allows you to revert the repository to a previous state captured in an oplog snapshot.

      You need to provide the SHA of the oplog entry you want to restore to, which you can find by running but oplog.
    flag:
      help: Print help (see a summary with '-h')
- name: undo
  description: Undo the last operation by reverting to the previous snapshot
  flags:
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Undo the last operation by reverting to the previous snapshot.

      This is a shorthand for restoring to the last oplog entry before the current one. It allows you to quickly undo the most recent operation.
    flag:
      help: Print help (see a summary with '-h')
- name: snapshot
  description: Create an on-demand snapshot with optional message
  flags:
    -h, --help: Print help (see more with '--help')
    -m, --message=: Message to include with the snapshot
  documentation:
    command: |-
      Create an on-demand snapshot with optional message.

      This allows you to create a named snapshot of the current state, which can be helpful to always be able to return to a known good state.

      You can provide an optional message to describe the snapshot.
    flag:
      help: Print help (see a summary with '-h')
- name: absorb
  description: Amends changes into the appropriate commits where they belong
  flags:
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Amends changes into the appropriate commits where they belong.

      The semantic for finding "the appropriate commit" is as follows:

      - Changes are amended into the topmost commit of the leftmost (first) lane (branch)
      - If a change is assigned to a particular lane (branch), it will be amended into a commit there
      - If there are no commits in this branch, a new commit is created
      - If a change has a dependency to a particular commit, it will be amended into that particular commit

      Optionally an identifier to an Uncommitted File or a Branch (stack) may be provided.

      - If an Uncommitted File id is provided, absorb will be performed for just that file
      - If a Branch (stack) id is provided, absorb will be performed for all changes assigned to that stack
      - If no source is provided, absorb is performed for all uncommitted changes
    flag:
      help: Print help (see a summary with '-h')
- name: forge
  description: Commands for interacting with forges like GitHub, GitLab (coming soon), etc
  flags:
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Commands for interacting with forges like GitHub, GitLab (coming soon), etc.

      The but forge tools allow you to authenticate with a forge from the CLI, which then enables features like creating pull requests with the but review commands.

      Start by running but forge auth to authenticate with your forge.

      You can also authenticate several different users on a forge and see them listed with but forge list-users or forget a user with but forge forget.

      Currently only GitHub is supported, but more forges will be added in the near future.
    flag:
      help: Print help (see a summary with '-h')
  commands:
  - name: auth
    description: Authenticate with your forge provider (at the moment, only GitHub is supported)
    flags:
      -h, --help: Print help
  - name: list-users
    description: List authenticated forge accounts known to GitButler
    flags:
      -h, --help: Print help
  - name: forget
    description: Forget a previously authenticated forge account
    flags:
      -h, --help: Print help
  - name: help
    description: Print this message or the help of the given subcommand(s)
    commands:
    - name: auth
      description: Authenticate with your forge provider (at the moment, only GitHub is supported)
    - name: list-users
      description: List authenticated forge accounts known to GitButler
    - name: forget
      description: Forget a previously authenticated forge account
    - name: help
      description: Print this message or the help of the given subcommand(s)
- name: review
  description: Commands for creating and publishing code reviews to a forge
  flags:
    -h, --help: Print help (see more with '--help')
  documentation:
    command: |-
      Commands for creating and publishing code reviews to a forge.

      If you are authenticated with a forge using but forge auth, you can use the but review commands to create pull requests (or merge requests) on the remote repository for your branches.
    flag:
      help: Print help (see a summary with '-h')
  commands:
  - name: publish
    description: Publish review requests for active branches in your workspace. By default, publishes reviews for all active branches
    flags:
      -b, --branch=: Publish reviews only for the specified branch
      -t, --default: Use the default content for the review title and description, skipping any prompts. If the review contains only a single commit, the commit message will be used for the review title and description
      -h, --help: Print help
      -r, --run-hooks: Run pre-push hooks (defaults to true)
      -s, --skip-force-push-protection: Skip force push protection checks
      -f, --with-force: Force push even if it's not fast-forward (defaults to true)
  - name: template
    description: Configure the template to use for review descriptions. This will list all available templates found in the repository and allow you to select one
    flags:
      -h, --help: Print help
  - name: help
    description: Print this message or the help of the given subcommand(s)
    commands:
    - name: publish
      description: Publish review requests for active branches in your workspace. By default, publishes reviews for all active branches
    - name: template
      description: Configure the template to use for review descriptions. This will list all available templates found in the repository and allow you to select one
    - name: help
      description: Print this message or the help of the given subcommand(s)
- name: help
  description: Print this message or the help of the given subcommand(s)
  commands:
  - name: status
    description: Overview of the project workspace state
  - name: rub
    description: Combines two entities together to perform an operation like amend, squash, assign, or move
  - name: init
    description: Initializes a GitButler project from a git repository in the current directory
  - name: base
    description: Commands for managing the base target branch
    commands:
    - name: check
      description: Fetches from the remote and checks the mergeability of the branches in the workspace
    - name: update
      description: Updates all applied branches to be up to date with the target branch
  - name: branch
    description: Commands for managing branches
    commands:
    - name: new
      description: Creates a new branch in the workspace
    - name: delete
      description: Deletes a branch from the workspace
    - name: list
      description: List the branches in the repository
    - name: show
      description: Show commits ahead of base for a specific branch
    - name: apply
      description: Apply a branch to the workspace
    - name: unapply
      description: Unapply a branch from the workspace
  - name: mark
    description: Mark a commit or branch for auto-assign or auto-commit
  - name: unmark
    description: Removes any marks from the workspace
  - name: gui
    description: Open the GitButler GUI for the current project
  - name: commit
    description: Commit changes to a stack
  - name: push
    description: Push changes in a branch to remote
  - name: new
    description: Insert a blank commit before the specified commit, or at the top of a stack
  - name: describe
    description: Edit the commit message of the specified commit
  - name: oplog
    description: Show operation history
  - name: restore
    description: Restore to a specific oplog snapshot
  - name: undo
    description: Undo the last operation by reverting to the previous snapshot
  - name: snapshot
    description: Create an on-demand snapshot with optional message
  - name: absorb
    description: Amends changes into the appropriate commits where they belong
  - name: forge
    description: Commands for interacting with forges like GitHub, GitLab (coming soon), etc
    commands:
    - name: auth
      description: Authenticate with your forge provider (at the moment, only GitHub is supported)
    - name: list-users
      description: List authenticated forge accounts known to GitButler
    - name: forget
      description: Forget a previously authenticated forge account
  - name: review
    description: Commands for creating and publishing code reviews to a forge
    commands:
    - name: publish
      description: Publish review requests for active branches in your workspace. By default, publishes reviews for all active branches
    - name: template
      description: Configure the template to use for review descriptions. This will list all available templates found in the repository and allow you to select one
  - name: help
    description: Print this message or the help of the given subcommand(s)
